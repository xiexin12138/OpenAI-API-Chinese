# **代码补全** (有限地测试中)
学习如何生成或操作代码

## **介绍**
[Codex系列模型](https://platform.openai.com/docs/models/codex)是基于我们的[GPT-3系列模型](https://platform.openai.com/docs/models/base-series)，并且已经同时经过自然语言和百万行代码的训练。它最擅长Python并且熟练十几种语言包括Javascript、Go、Perl、PHP、Ruby、Swift、TypeScript、SQL甚至是Shell。在最初有限测试的期间，Codex的可以免费使用。[了解更多](https://platform.openai.com/docs/models/codex)

你可以使用Codex来完成多种任务，包括：
- 将注释转换成代码
- 基于上下文完成你的下一行或者function
- 增长你的知识面，比如为应用找到合适的库或者API调用
- 添加注释
- 重构代码以提高效率

想看看Codex的实际操作，可以查看我们的[Codex Javascript沙盒](https://platform.openai.com/codex-javascript-sandbox)或者我们其他的[示例视频](https://www.youtube.com/playlist?list=PLOXw6I10VTv_FhQbbvYh1FvbiaPf43Ve2)。

![](./image/sandbox-screenshot.png)

## **快速开始**

开始自己使用Codex，在[在线编辑器](https://platform.openai.com/playground)中打开这个示例。

### **说“Hello”（Python）**
```Python
"""
询问用户的名字并说Hello
"""
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%22%22%22%0AAsk%20the%20user%20for%20their%20name%20and%20say%20%22Hello%22%0A%22%22%22)

### **创建一个随机的名字（Python）**
```Python
"""
1. 创建一个名字的列表
2. 创建一个姓的列表
3. 将他们随机组合成有100个完整名字的列表
"""
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%22%22%22%0A1.%20Create%20a%20list%20of%20first%20names%0A2.%20Create%20a%20list%20of%20last%20names%0A3.%20Combine%20them%20randomly%20into%20a%20list%20of%20100%20full%20names%0A%22%22%22)

### **创建一个MySql的查询语句（Python）**
```Python
"""
表格名为customers，列 = [CustomerId, FirstName, LastName, Company, Address, City, State, Country, PostalCode, Phone, Fax, Email, SupportRepId]
为所有在得克萨斯州名为Jane的顾客创建一个SQL查询
"""
query = 
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%22%22%22%0ATable%20customers%2C%20columns%20%3D%20%5BCustomerId%2C%20FirstName%2C%20LastName%2C%20Company%2C%20Address%2C%20City%2C%20State%2C%20Country%2C%20PostalCode%2C%20Phone%2C%20Fax%2C%20Email%2C%20SupportRepId%5D%0ACreate%20a%20MySQL%20query%20for%20all%20customers%20in%20Texas%20named%20Jane%0A%22%22%22%0Aquery%20%3D)

### **解释代码（JavaScript）**
```javascript
// Function 1
var fullNames = [];
for (var i = 0; i < 50; i++) {
  fullNames.push(names[Math.floor(Math.random() * names.length)]
    + " " + lastNames[Math.floor(Math.random() * lastNames.length)]);
}

// Function 1 做了什么？
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%2F%2F%20Function%201%0Avar%20fullNames%20%3D%20%5B%5D%3B%0Afor%20%28var%20i%20%3D%200%3B%20i%20%3C%2050%3B%20i%2B%2B%29%20%7B%0A%20%20fullNames.push%28names%5BMath.floor%28Math.random%28%29%20%2A%20names.length%29%5D%0A%20%20%20%20%2B%20%22%20%22%20%2B%20lastNames%5BMath.floor%28Math.random%28%29%20%2A%20lastNames.length%29%5D%29%3B%0A%7D%0A%0A%2F%2F%20What%20does%20Function%201%20do%3F)

### **更多示例**
访问我们的[示例库](https://platform.openai.com/examples?category=code)，探索更多为Codex设计的功能。

## **最佳实践**
从一句注释、数据或代码开始。你可以在我们的在线编辑器中尝试使用任一Codex模型（在需要的时候将指令作为注释）。

为了让Codex更好地进行补全，我们需要思考程序员在完成任务时需要哪些信息。这可能只是一个清晰的注释或者写一个有用的function所需要的数据，如变量名名或者是处理function的类。

```python
 # 创建一个名为‘nameImporter’的function，来将姓和名存入到数据库中
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20Create%20a%20function%20called%20%27nameImporter%27%20to%20add%20a%20first%20and%20last%20name%20to%20the%20database)

在这个例子中，我们告诉Codex要调用的function以及他将要执行的任务。

这种方式你甚至可以给Codex提供注释和数据库的样例schema，让它为各种数据库写一些有用的查询请求。
```python
 # Table albums, columns = [AlbumId, Title, ArtistId]
 # Table artists, columns = [ArtistId, Name]
 # Table media_types, columns = [MediaTypeId, Name]
 # Table playlists, columns = [PlaylistId, Name]
 # Table playlist_track, columns = [PlaylistId, TrackId]
 # Table tracks, columns = [TrackId, Name, AlbumId, MediaTypeId, GenreId, Composer, Milliseconds, Bytes, UnitPrice]

 为所有阿黛尔的专辑创建一个查询
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20Table%20albums%2C%20columns%20%3D%20%5BAlbumId%2C%20Title%2C%20ArtistId%5D%0A%23%20Table%20artists%2C%20columns%20%3D%20%5BArtistId%2C%20Name%5D%0A%23%20Table%20media_types%2C%20columns%20%3D%20%5BMediaTypeId%2C%20Name%5D%0A%23%20Table%20playlists%2C%20columns%20%3D%20%5BPlaylistId%2C%20Name%5D%0A%23%20Table%20playlist_track%2C%20columns%20%3D%20%5BPlaylistId%2C%20TrackId%5D%0A%23%20Table%20tracks%2C%20columns%20%3D%20%5BTrackId%2C%20Name%2C%20AlbumId%2C%20MediaTypeId%2C%20GenreId%2C%20Composer%2C%20Milliseconds%2C%20Bytes%2C%20UnitPrice%5D%0A%0A%23%20Create%20a%20query%20for%20all%20albums%20by%20Adele)

当你向Codex展示一个数据库的schema时，它可以有依据地猜测出如何去格式化查询。

**指明语言**。Codex掌握十几种编程语言，许多语言在注释、函数或编程语法有类似的约定。通过在注释中指明语言和版本，Codex可以更好的为你提供想要的代码补全能力，Codex在风格和语法上相当灵活。

```python
 # R语言
 # 计算点数组之间的平均距离
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20R%20language%0A%23%20Calculate%20the%20mean%20distance%20between%20an%20array%20of%20points)

```python
 # Python
 # 计算点数组之间的平均距离
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20Python%203%0A%23%20Calculate%20the%20mean%20distance%20between%20an%20array%20of%20points)

***提示Codex你想要它做什么***。如果你想Codex创建一个网页，在你告诉它要做什么的注释之后，放一个在Html文档（`<!DOCTYPE html>`）的第一行代码。
```html
<!-- 创建一个网页，title为'Kat Katman attorney at paw' -->
<!DOCTYPE html>
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%3C%21--%20Create%20a%20web%20page%20with%20the%20title%20%27Kat%20Katman%20attorney%20at%20paw%27%20--%3E%0A%3C%21DOCTYPE%20html%3E)

在我们的注释之后放一个`<!DOCTYPE html>`，可以让Codex明确知道我们想要它做什么。
```python
 创建一个数到100的函数

def counter
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20Create%20a%20function%20to%20count%20to%20100%0A%0Adef%20counter)


如果我们开始写函数，Codex将会明白接下来它将需要干什么。

**指明函数库可以让Codex明白你想要什么**。Codex知道大量的库、API或者model。通过告诉Codex使用哪一个，不论是用注释或者直接在代码中导入的方式，Codex将会在此基础上提出建议而不是替代方案。
```html
<!-- 使用版本为1.2.0的A-Frame库，创建一个3D到网站 -->
<!-- https://aframe.io/releases/1.2.0/aframe.min.js -->
```
通过指明版本，你可以确保Codex使用最新的库。

提示：Codex可以建议有用的库或则API，但你需要自己再去调研下以确保它们对你应用来说是安全的。

**注释风格会影响代码质量**。在某些语言中，注释的风格可以提升输出的质量。例如，当使用Python时，在某些情况下，使用doc字符串注释（用三引号括起来）可以比通过使用井号(#)注释提供更高质量的结果。
```python
"""
创建一个用户和邮箱地址的数组
"""
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%22%22%22%0ACreate%20an%20array%20of%20users%20and%20email%20addresses%0A%22%22%22)

**在函数中添加注释会很有帮助**。推荐的编码标准通常建议将函数的注释放在其内部。使用这种格式可以让Codex更清楚地知道你想要这个函数做什么。
```python
def getUserBalance(id):
    """
    Look up the user in the database ‘UserData' and return their current account balance.
    """
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=def%20getUserBalance%28id%29%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20Look%20up%20the%20user%20in%20the%20database%20‘UserData%27%20and%20return%20their%20current%20account%20balance.%0A%20%20%20%20%22%22%22)

**提供示例来获取更精准的结果**。如果你需要Codex去使用特别的风格或者格式，在第一部份提供例子或者示范它能让Codex更精准地了解你想要的。
```python
"""
创建一个随机动物和物种的列表
"""
animals  = [ {"name": "Chomper", "species": "Hamster"}, {"name":
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%22%22%22%0ACreate%20a%20list%20of%20random%20animals%20and%20species%0A%22%22%22%0Aanimals%20%20%3D%20%5B%20%7B%22name%22%3A%20%22Chomper%22%2C%20%22species%22%3A%20%22Hamster%22%7D%2C%20%7B%22name%22%3A)

**更低的 `temperatures` 给出更准确的结果**。在大多数情况下，设置 API 的 `temperatures` 为0， 或者接近零（比如 0.1 或 0.2）将得出一个更好的结果。不像 GPT-3， 更高的 `temperatures` 可以提供有用的创造性和随机的结果， Codex更高的 `temperatures` 会给你一个真随机和不稳定的响应。如果你真的需要Codex提供不同可能性的结果，可以从零开始，并且每次增加 0.1 直到你找到合适的结果值。

**将任务组织成函数**。我们可以在注释中，用尽可能清晰的术语描述需要的函数，并让Codex去实现它。通过下面的注释，Codex创建了一个用户点击按钮触发的 Javascript 计时器函数：
一个简单的 Javascript 计时器
```javascript
// 创建一个计时器，在 10 秒内创建告警
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%2F%2F%20Create%20a%20timer%20that%20creates%20an%20alert%20in%2010%20seconds)

我们可以使用Codex与知名的库一起执行常见任务，例如使用Stripe API创建客户:

用Python创建一个 Stripe 客户：
```python
# 从邮箱地址创建一个 Stripe 客户
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%23%20Create%20a%20Stripe%20customer%20from%20an%20email%20address)

**创建示例数据**。测试应用通常需要使用示例数据。因为Codgen是一个直到如何理解和编写自然语言的语言模型，所以您可以让Codex创建数据，例如由名称、产品和其他变量组成的数组。

```javascript
/* 创建一个旧金山的天气数组 */
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%2F%2A%20Create%20an%20array%20of%20weather%20temperatures%20for%20San%20Francisco%20%2A%2F)

让 Codex 执行这个任务会生成一个像这样的表格：
```javascript
var weather = [
  { month: 'January', high: 58, low: 48 },
  { month: 'February', high: 61, low: 50 },
  { month: 'March', high: 64, low: 53 },
  { month: 'April', high: 67, low: 55 },
  { month: 'May', high: 70, low: 58 },
  { month: 'June', high: 73, low: 61 },
  { month: 'July', high: 76, low: 63 },
  { month: 'August', high: 77, low: 64 },
  { month: 'September', high: 76, low: 63 },
  { month: 'October', high: 73, low: 61 },
  { month: 'November', high: 68, low: 57 },
  { month: 'December', high: 64, low: 54 }
];
```
[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=var%20weather%20%3D%20%5B%0A%20%20%7B%20month%3A%20%27January%27%2C%20high%3A%2058%2C%20low%3A%2048%20%7D%2C%0A%20%20%7B%20month%3A%20%27February%27%2C%20high%3A%2061%2C%20low%3A%2050%20%7D%2C%0A%20%20%7B%20month%3A%20%27March%27%2C%20high%3A%2064%2C%20low%3A%2053%20%7D%2C%0A%20%20%7B%20month%3A%20%27April%27%2C%20high%3A%2067%2C%20low%3A%2055%20%7D%2C%0A%20%20%7B%20month%3A%20%27May%27%2C%20high%3A%2070%2C%20low%3A%2058%20%7D%2C%0A%20%20%7B%20month%3A%20%27June%27%2C%20high%3A%2073%2C%20low%3A%2061%20%7D%2C%0A%20%20%7B%20month%3A%20%27July%27%2C%20high%3A%2076%2C%20low%3A%2063%20%7D%2C%0A%20%20%7B%20month%3A%20%27August%27%2C%20high%3A%2077%2C%20low%3A%2064%20%7D%2C%0A%20%20%7B%20month%3A%20%27September%27%2C%20high%3A%2076%2C%20low%3A%2063%20%7D%2C%0A%20%20%7B%20month%3A%20%27October%27%2C%20high%3A%2073%2C%20low%3A%2061%20%7D%2C%0A%20%20%7B%20month%3A%20%27November%27%2C%20high%3A%2068%2C%20low%3A%2057%20%7D%2C%0A%20%20%7B%20month%3A%20%27December%27%2C%20high%3A%2064%2C%20low%3A%2054%20%7D%0A%5D%3B)

**将函数组合成小应用**。我们可以给 Codex 提供一些复杂请求的注释，像创建一个随机名字生成器或，或者是执行带有用户输入的任务，如果有足够的 token ， Codex 可以生成余下的内容。

```javascript
/*
创建一个动物的列表
创建一个城市的列表
使用上面的列表，生成一个故事关于我在每个城市的动物园的所见所闻
*/
```

[在线编辑器中打开](https://platform.openai.com/playground?model=code-davinci-002&prompt=%2F%2A%0ACreate%20a%20list%20of%20animals%0ACreate%20a%20list%20of%20cities%0AUse%20the%20lists%20to%20generate%20stories%20about%20what%20I%20saw%20at%20the%20zoo%20in%20each%20city%0A%2A%2F)

**限制补全的大小来获取更精准的结果或是更快的响应。在 Codex 中请求过长的补全可能会导致不清晰的答案或过于啰嗦。通过降低 `max_tokens` 和在 `stop` 中设置 token 来限制查询参数的大小。比如说，把 `\n` 添加到 `stop` 中来限制补全只有一行代码。更小的补全能有更快的响应。

**使用 流 ( streaming ) 来减少响应时间。过大的 Codex 请求会耗费十几秒来完成补全。如果开发的应用有低延迟的要求，比如像要自动完成补全的代码助手，就可以考虑使用流。请求会在模型生成完整的补全之前开始返回。如果应用只需要部分的补全，可以通过程序的方式或者是使用 `stop` 中的字符串的方式进行中止。

用户可以通过从 API 请求多次结果并使用返回的第一个响应，将流式处理与复制结合起来以减少延迟。通过设置 `n > 1` 实现。这个方法会消耗更多的 token， 所以用的时候要小心 ( 比如，合理地使用设置项 `max_tokens` 和 `stop` )。

**让 Codex 解释代码行为**。 Codex 创建和理解代码的能力让我们可以用它去完成一些像解释文件中代码行为的任务。一种实现这个目的方法是，把带有“这个方法”或“这个应用是”开头的注释放到函数的末尾。 Codex 会把注释作为解释的开头并完成剩余的部分。

```javascript
/* 解释前面的函数做了什么： 它  */
```

**解释一个 SQL 查询**。在这个例子中，我们让 Codex 用成人类可以理解的语言，解释 SQL 查询语句做的是什么。 
```SQL
SELECT DISTINCT department.name
FROM department
JOIN employee ON department.id = employee.department_id
JOIN salary_payments ON employee.id = salary_payments.employee_id
WHERE salary_payments.date BETWEEN '2020-06-01' AND '2020-06-30'
GROUP BY department.name
HAVING COUNT(employee.id) > 10;
-- 用人类可以理解的语言，解释上面的查询语句
```

**编写单元测试**。通过简单地添加 “Unit test” (译者注:即单元测试) 并写上一个函数的开头，就可以简单地用Python创建一个单元测试。
```python
# Python 3
def sum_numbers(a, b):
  return a + b

# Unit test
def
```

**检查代码错误**。通过示例，你可以知道怎么让 Codex 去找到代码中的错误。有些情况下不需要示例，但是展示描述的级别和细节，可以帮助Codex了解要寻找什么以及如何解释它。( Codex 的错误检查不能代替用户的仔细评审。)
```javascript
/* 解释前面的代码为什么不执行 */
```

**使用源数据编写数据库函数**。就像人类程序员能理解数据库结构和列名中，并进行工作一样， Codex 可以使用这些数据来帮你写一个精确的查询请求。在这个例子中，我们为一个数据插入了一个 schema 并且告诉 Codex 要查询数据库的什么。

```Python
# Table albums, columns = [AlbumId, Title, ArtistId]
# Table artists, columns = [ArtistId, Name]
# Table media_types, columns = [MediaTypeId, Name]
# Table playlists, columns = [PlaylistId, Name]
# Table playlist_track, columns = [PlaylistId, TrackId]
# Table tracks, columns = [TrackId, Name, AlbumId, MediaTypeId, GenreId, Composer, Milliseconds, Bytes, UnitPrice]

# 创建一个查询阿黛尔全部专辑的语句
```

# 待更新完成